---
phase: 03-time-based-rotation
plan: 04
type: execute
wave: 4
depends_on: [03-03]
files_modified:
  - src/config.ts
  - test/config.test.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can configure daily rotation via configure({ file, rotation: { pattern: 'daily' } })"
    - "configure() passes pattern to FileTransport constructor"
    - "TypeScript types support pattern field in rotation config"
    - "Existing rotation config (maxSize) continues to work unchanged"
  artifacts:
    - path: "src/config.ts"
      provides: "Rotation config integration in configure()"
      contains: "pattern field handling"
    - path: "test/config.test.ts"
      provides: "Tests for rotation config with pattern field"
      contains: "pattern: 'daily' test case"
  key_links:
    - from: "configure()"
      to: "FileTransport constructor"
      via: "rotation config passing"
      pattern: "new FileTransport.*rotation"
    - from: "configure()"
      to: "RotationConfig type"
      via: "type checking"
      pattern: "rotation.*RotationConfig"
---

<objective>
Integrate time-based rotation configuration into public API via configure() function.

Purpose: Enable users to configure daily rotation pattern using the public configure() API. Ensure pattern field is correctly passed to FileTransport constructor and maintain backward compatibility with existing rotation configuration (maxSize). Add tests to verify configuration integration.

Output: configure() function supports pattern field in rotation config, with comprehensive tests and backward compatibility maintained.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-time-based-rotation/03-01-SUMMARY.md
@.planning/phases/03-time-based-rotation/03-02-SUMMARY.md
@.planning/phases/03-time-based-rotation/03-03-SUMMARY.md

@src/config.ts
@src/types.ts
@src/transports/file-transport.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update configure() to pass pattern to FileTransport</name>
  <files>src/config.ts</files>
  <action>
    Review current configure() implementation to understand how rotation config is passed to FileTransport.

    Update file shorthand handling in configure() function:
    1. Find the section where file shorthand is processed (look for `new FileTransport`)
    2. Ensure rotation config (including pattern field) is passed to FileTransport constructor
    3. Pattern should be passed in options parameter: `{ pattern: rotation.pattern, maxSize: rotation.maxSize }`

    Implementation approach:
    - If rotation.pattern exists, pass it in FileTransport options
    - If rotation.maxSize exists, pass it in FileTransport options
    - Both fields should be passed if present (hybrid rotation)

    Reference existing rotation config handling (should already pass maxSize).
    Add pattern field to the options object being passed.

    The code should look like:
    ```typescript
    const fileTransport = new FileTransport(file, {
        maxSize: rotation?.maxSize,
        pattern: rotation?.pattern
    });
    ```

    Ensure backward compatibility: if rotation is undefined, don't pass any options.
  </action>
  <verify>
    grep -A 5 "new FileTransport" src/config.ts | grep -q "pattern"
  </verify>
  <done>
    configure() passes pattern field to FileTransport constructor when provided
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tests for pattern configuration</name>
  <files>test/config.test.ts</files>
  <action>
    Add test cases to test/config.test.ts for pattern configuration:

    Test cases to add:

    1. Test daily pattern configuration:
       ```typescript
       it('should configure daily rotation pattern', () => {
           configure({
               file: './test-logs/config-daily.log',
               rotation: { pattern: 'daily' }
           });

           // Verify FileTransport is created with daily pattern
           // (This may require accessing internal state or checking transport creation)
       });
       ```

    2. Test hybrid rotation (pattern + maxSize):
       ```typescript
       it('should configure hybrid rotation with pattern and maxSize', () => {
           configure({
               file: './test-logs/config-hybrid.log',
               rotation: {
                   pattern: 'daily',
                   maxSize: '50MB'
               }
           });

           // Verify both options are passed
       });
       ```

    3. Test backward compatibility (maxSize only):
       ```typescript
       it('should continue to support maxSize-only rotation config', () => {
           configure({
               file: './test-logs/config-size.log',
               rotation: { maxSize: '100MB' }
           });

           // Verify existing config still works
       });
       ```

    4. Test no rotation (backward compatibility):
       ```typescript
       it('should create file transport without rotation when not configured', () => {
           configure({
               file: './test-logs/config-no-rotation.log'
           });

           // Verify file logging works without rotation
       });
       ```

    Note: Some tests may require accessing internal FileTransport state or using test helpers.
    Focus on verifying configure() doesn't throw errors and creates valid transports.

    Run `npm test` to verify all tests pass.
  </action>
  <verify>
    npm test 2>&1 | grep -q "passing"
    grep -n "pattern.*daily" test/config.test.ts returns test cases
  </verify>
  <done>
    Test coverage for pattern configuration in configure() function
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds with no errors
2. configure() accepts pattern field in rotation config
3. Pattern is correctly passed to FileTransport constructor
4. Existing rotation config (maxSize only) continues to work
5. All tests pass (npm test shows 100% passing)
</verification>

<success_criteria>
1. Users can configure daily rotation via configure({ file, rotation: { pattern: 'daily' } })
2. Pattern field is integrated into public API
3. Backward compatibility maintained (existing rotation configs unchanged)
4. Tests verify configuration integration
</success_criteria>

<output>
After completion, create `.planning/phases/03-time-based-rotation/03-04-SUMMARY.md`
</output>
