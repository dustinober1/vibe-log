---
phase: 04-async-compression
plan: 05
type: execute
wave: 4
depends_on: [04-04]
files_modified: [README.md]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "README.md documents compression feature"
    - "Compression section explains levels 1-9 and default behavior"
    - "Examples show compression configuration with rotation"
    - "Migration guide explains adding compression to existing rotation"
    - "Benefits of compression documented (disk space, performance)"
    - "Fire-and-forget behavior documented"
    - "Error handling documented (failed/ directory)"
  artifacts:
    - path: "README.md"
      provides: "Compression documentation"
      contains: "Compression"
      min_lines: 80  # New compression documentation section
  key_links:
    - from: "README.md"
      to: "RotationConfig interface"
      via: "compressionLevel field documentation"
      pattern: "compressionLevel"
    - from: "README.md"
      to: "src/utils/compression.ts"
      via: "compressRotatedFile utility description"
      pattern: "compressRotatedFile"
---

<objective>
Document async compression features in README.md with examples and migration guide

Purpose: Enable users to understand and adopt gzip compression for rotated log files
Output: Complete compression documentation in README.md
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-async-compression/04-CONTEXT.md
@.planning/phases/04-async-compression/04-RESEARCH.md
@README.md
@src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add compression section to README.md</name>
  <files>README.md</files>
  <action>
    Add comprehensive compression documentation to README.md:

    **1. Add "Log Compression" section after existing rotation sections:**
       - Place after "Time-based Rotation" section
       - Before "API Reference" section

    **2. Section content to add:**

       ```markdown
       ## Log Compression

       Rotated log files can be automatically compressed using gzip to save disk space.
       Compression runs asynchronously (fire-and-forget) without blocking your application.

       ### Compression Levels

       Compression level controls the trade-off between speed and file size:

       | Level | Speed | Size | Use Case |
       |-------|-------|------|----------|
       | 1 | Fastest | Largest | High-volume logging, fast rotation |
       | 6 | Balanced | Balanced | Default, recommended for most cases |
       | 9 | Slowest | Smallest | Limited disk space, infrequent rotation |

       Default: `6` (balanced compression)

       ### Configuration

       Enable compression by setting `compressionLevel` in rotation config:

       ```typescript
       import { configure } from '@your-package/log-vibe';

       // Compress rotated files with level 6 (balanced)
       configure({
         file: './logs/app.log',
         rotation: {
           maxSize: '100MB',
           compressionLevel: 6,  // Balanced compression
         }
       });

       // Fast compression for high-volume logging
       configure({
         file: './logs/app.log',
         rotation: {
           maxSize: '100MB',
           compressionLevel: 1,  // Fastest, larger files
         }
       });

       // Maximum compression for limited disk space
       configure({
         file: './logs/app.log',
         rotation: {
           maxSize: '100MB',
           compressionLevel: 9,  // Slowest, smallest files
         }
       });

       // Compression with daily rotation
       configure({
         file: './logs/app.log',
         rotation: {
           pattern: 'daily',
           compressionLevel: 6,
         }
       });
       ```

       ### How It Works

       1. **Rotation**: Log file rotates when size threshold exceeded or daily at midnight UTC
       2. **Delay**: Compression starts after 10ms delay to avoid CPU spikes during active logging
       3. **Compression**: Rotated file compressed to `.gz` using specified compression level
       4. **Cleanup**: Original uncompressed file deleted after successful compression
       5. **Fire-and-forget**: Compression runs asynchronously without blocking the `log()` method

       ### Error Handling

       If compression fails (disk full, permissions, etc.):

       - Error logged to console: `[FileTransport] Compression failed for {file}: {error}`
       - Uncompressed file moved to `failed/` subdirectory in log directory
       - Application continues logging (no crash)
       - Manual inspection/retry required for failed files

       Example failed file location:
       ```
       ./logs/failed/app-2026-01-18.log.1
       ```

       ### Benefits

       - **Disk space**: Compressed files are typically 5-10x smaller than uncompressed
       - **Performance**: Asynchronous compression doesn't block logging
       - **Flexibility**: Choose speed or size based on your needs
       - **Reliability**: Failed compression doesn't crash your application
       ```

    **3. Update RotationConfig Options table in API Reference section:**
       Add compressionLevel row to existing table:

       ```markdown
       ### RotationConfig Options

       | Option | Type | Default | Description |
       |--------|------|---------|-------------|
       | maxSize | string \| number | '100MB' | Maximum file size before rotation |
       | pattern | 'daily' | undefined | Time-based rotation pattern (daily at midnight UTC) |
       | compressionLevel | number | undefined | Gzip compression level (1-9, 6 = balanced) |
       ```

    **4. Add migration scenario to existing Migration Guide:**
       Add to existing migration guide or create new subsection:

       ```markdown
       #### Add Compression to Existing Rotation

       **Before:** Size-based rotation without compression
       ```typescript
       configure({
         file: './logs/app.log',
         rotation: {
           maxSize: '100MB',
         }
       });
       ```

       **After:** Add compression to save disk space
       ```typescript
       configure({
         file: './logs/app.log',
         rotation: {
           maxSize: '100MB',
           compressionLevel: 6,  // Add compression
         }
       });
       ```

       **Benefits:** Rotated files compressed automatically, disk space reduced 5-10x
       ```

    DO NOT:
    - Do not modify existing rotation sections (only add new compression section)
    - Do not change existing API reference tables (only add compressionLevel row)
    - Do not add compression examples to unrelated sections
    - Do not document internal implementation details (keep user-facing)

    Documentation structure from CONTEXT.md:
    - Conceptual overview (what and why)
    - Configuration examples (how to use)
    - Error handling (what happens when things fail)
    - Migration guide (how to adopt incrementally)
  </action>
  <verify>
  Check that:
  - "Log Compression" section exists in README.md
  - Compression levels 1-9 documented with use cases
  - Configuration examples show different compression levels
  - "How It Works" section explains fire-and-forget pattern
  - Error handling documented with failed/ directory
  - RotationConfig table includes compressionLevel row
  - Migration guide shows adding compression to existing rotation
  </verify>
  <done>
  Compression documentation complete in README.md
  </done>
</task>

</tasks>

<verification>
- README.md includes comprehensive compression section
- Compression levels documented (1-9 with use cases)
- Configuration examples provided for different scenarios
- Error handling documented (failed/ directory)
- Migration guide shows adding compression to existing rotation
- API reference updated with compressionLevel field
</verification>

<success_criteria>
Complete compression documentation that:
- Explains what compression is and why to use it
- Documents compression levels 1-9 with use cases
- Shows configuration examples for different scenarios
- Explains fire-and-forget async behavior
- Documents error handling and failed file recovery
- Provides migration guide for adding compression
- Updates API reference with compressionLevel field
</success_criteria>

<output>
After completion, create `.planning/phases/04-async-compression/04-05-SUMMARY.md`
</output>
